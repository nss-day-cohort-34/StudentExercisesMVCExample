@model StudentExerciseReportViewModel

@{
    ViewData["Title"] = "Student Exercise Report";
}

<h1>Student Exercise Report</h1>

<div class="row">
    <label for="cohort-select">Cohort</label>
    <select id="cohort-select" asp-items="@Model.CohortOptions"></select>
</div>
<div class="row">
    <canvas id="output"></canvas>
</div>

@* It's all javascript below this line. Remember this code runs on the client. *@
@section scripts {

@* 
    Pull in the chart.js library from a Content Delivery Network (CDN) 
    
    Chart.js documentation
    https://www.chartjs.org/docs/latest/getting-started/
*@
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script>

    function getStudentsInCohort(cohortId) {
        // Hit the API running in our .net app
        return fetch(`/api/StudentExerciseReportAPI/${cohortId}`)
            .then(resp => resp.json());
    }

    const cohortSelect = document.getElementById('cohort-select');
    const output = document.getElementById('output').getContext('2d');
    let chart = null;

    cohortSelect.addEventListener("change", (evt) => {
        // If we already have a chart, destroy it to make room for the next one.
        if (chart) {
            chart.destroy();
        }

        const selectedCohortId = evt.target.value;

        getStudentsInCohort(selectedCohortId)
            .then(students => {
                chart = new Chart(output, {
                    type: 'bar',
                    data: {
                        labels: students.map(s => `${s.firstName} ${s.lastName}`),
                        datasets: [{
                            label: "Exercise Count",
                            data: students.map(s => s.exerciseCount)
                        }]
                    }
                });
            });
    });
</script>
}
